{% extends 'base.html' %}

{% block title %}Cài đặt | BinanceTrader Bot{% endblock %}

{% block content %}
<div class="container">
    <h2 class="mb-4">Cài đặt</h2>
    
    <!-- Tab navigation for mobile -->
    <ul class="nav nav-tabs d-md-none mb-4" id="settingsTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="api-tab" data-bs-toggle="tab" data-bs-target="#api-settings" type="button" role="tab" aria-controls="api-settings" aria-selected="true">
                <i class="fas fa-key me-1"></i> API
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="notification-tab" data-bs-toggle="tab" data-bs-target="#notification-settings" type="button" role="tab" aria-controls="notification-settings" aria-selected="false">
                <i class="fas fa-bell me-1"></i> Thông báo
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="security-tab" data-bs-toggle="tab" data-bs-target="#security-settings" type="button" role="tab" aria-controls="security-settings" aria-selected="false">
                <i class="fas fa-shield-alt me-1"></i> Bảo mật
            </button>
        </li>
    </ul>
    
    <!-- Tab content for mobile -->
    <div class="tab-content d-md-none mb-4" id="settingsTabContent">
        <div class="tab-pane fade show active" id="api-settings" role="tabpanel" aria-labelledby="api-tab">
            <div class="card bg-dark border-secondary">
                <div class="card-header bg-dark border-secondary">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-key me-2"></i> Cài đặt API
                    </h5>
                </div>
                <div class="card-body">
                    <form id="api-settings-form-mobile">
                        <div class="mb-3">
                            <label class="form-label">Chế độ API</label>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" name="api-mode" id="api-mode-demo" value="demo">
                                <label class="form-check-label" for="api-mode-demo">
                                    <span class="badge bg-secondary me-1">Demo</span> Giả lập (không dùng API key)
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" name="api-mode" id="api-mode-testnet" value="testnet">
                                <label class="form-check-label" for="api-mode-testnet">
                                    <span class="badge bg-warning text-dark me-1">Testnet</span> Môi trường thử nghiệm
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="api-mode" id="api-mode-live" value="live">
                                <label class="form-check-label" for="api-mode-live">
                                    <span class="badge bg-danger me-1">Live</span> Thị trường thực tế
                                </label>
                            </div>
                            <small class="form-text text-muted mt-2">
                                Demo: Không cần API key, Testnet: Môi trường thử nghiệm, Live: Giao dịch thực tế
                            </small>
                        </div>
                        
                        <div class="mb-3">
                            <label for="binance-api-key" class="form-label">Binance API Key</label>
                            <input type="text" class="form-control" id="binance-api-key" placeholder="Nhập API Key">
                        </div>
                        
                        <div class="mb-3">
                            <label for="binance-api-secret" class="form-label">Binance API Secret</label>
                            <input type="password" class="form-control" id="binance-api-secret" placeholder="Nhập API Secret">
                        </div>
                        
                        <div class="d-grid">
                            <button type="button" class="btn btn-primary" id="test-api-button">
                                <i class="fas fa-check-circle me-1"></i> Kiểm tra kết nối
                            </button>
                        </div>
                        
                        <div class="mt-3 p-2 border border-secondary rounded" id="api-connection-status">
                            <div class="text-muted small">Trạng thái kết nối sẽ hiển thị ở đây</div>
                        </div>
                    </form>
                </div>
                <div class="card-footer bg-dark border-secondary">
                    <div class="d-grid">
                        <button type="button" class="btn btn-success" id="save-api-button">
                            <i class="fas fa-save me-1"></i> Lưu cài đặt API
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-4 mb-4">
            <div class="card bg-dark border-secondary h-100">
                <div class="card-header bg-dark border-secondary">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-bell me-2"></i> Thông báo
                    </h5>
                </div>
                <div class="card-body">
                    <form id="notification-settings-form">
                        <div class="mb-3">
                            <label class="form-label">Cài đặt thông báo Telegram</label>
                            <div class="form-check form-switch mb-2">
                                <input class="form-check-input" type="checkbox" id="enable-telegram-notifications">
                                <label class="form-check-label" for="enable-telegram-notifications">
                                    Bật thông báo Telegram
                                </label>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="telegram-bot-token" class="form-label">Telegram Bot Token</label>
                            <input type="text" class="form-control" id="telegram-bot-token" placeholder="Nhập Bot Token">
                            <small class="form-text text-muted">
                                Tạo bot qua <a href="https://t.me/BotFather" target="_blank">BotFather</a> và lấy token
                            </small>
                        </div>
                        
                        <div class="mb-3">
                            <label for="telegram-chat-id" class="form-label">Telegram Chat ID</label>
                            <input type="text" class="form-control" id="telegram-chat-id" placeholder="Nhập Chat ID">
                            <small class="form-text text-muted">
                                Chat ID của người nhận hoặc nhóm
                            </small>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Tùy chọn thông báo</label>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="notify-new-trades" checked>
                                <label class="form-check-label" for="notify-new-trades">
                                    Thông báo giao dịch mới
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="notify-closed-trades" checked>
                                <label class="form-check-label" for="notify-closed-trades">
                                    Thông báo đóng giao dịch
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="notify-error-status" checked>
                                <label class="form-check-label" for="notify-error-status">
                                    Thông báo lỗi hệ thống
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="notify-daily-summary">
                                <label class="form-check-label" for="notify-daily-summary">
                                    Báo cáo tổng kết hàng ngày
                                </label>
                            </div>
                        </div>
                        
                        <div class="d-grid">
                            <button type="button" class="btn btn-primary" id="test-telegram-button">
                                <i class="fab fa-telegram me-1"></i> Gửi tin nhắn test
                            </button>
                        </div>
                    </form>
                </div>
                <div class="card-footer bg-dark border-secondary">
                    <div class="d-grid">
                        <button type="button" class="btn btn-success" id="save-notification-button">
                            <i class="fas fa-save me-1"></i> Lưu cài đặt thông báo
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-4 mb-4">
            <div class="card bg-dark border-secondary h-100">
                <div class="card-header bg-dark border-secondary">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-shield-alt me-2"></i> Cài đặt bảo mật
                    </h5>
                </div>
                <div class="card-body">
                    <form id="security-settings-form">
                        <div class="mb-3">
                            <label class="form-label">Quản lý rủi ro</label>
                            <div class="form-check form-switch mb-2">
                                <input class="form-check-input" type="checkbox" id="enable-stop-loss" checked>
                                <label class="form-check-label" for="enable-stop-loss">
                                    Luôn sử dụng Stop Loss
                                </label>
                            </div>
                            <div class="form-check form-switch mb-2">
                                <input class="form-check-input" type="checkbox" id="enable-take-profit" checked>
                                <label class="form-check-label" for="enable-take-profit">
                                    Luôn sử dụng Take Profit
                                </label>
                            </div>
                            <div class="form-check form-switch mb-2">
                                <input class="form-check-input" type="checkbox" id="enable-trailing-stop">
                                <label class="form-check-label" for="enable-trailing-stop">
                                    Sử dụng Trailing Stop
                                </label>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="max-open-positions" class="form-label">Số lượng vị thế mở tối đa</label>
                            <input type="number" class="form-control" id="max-open-positions" min="1" max="10" value="5">
                        </div>
                        
                        <div class="mb-3">
                            <label for="max-daily-trades" class="form-label">Số lượng giao dịch tối đa mỗi ngày</label>
                            <input type="number" class="form-control" id="max-daily-trades" min="0" max="100" value="20">
                            <small class="form-text text-muted">
                                Đặt 0 để không giới hạn
                            </small>
                        </div>
                        
                        <div class="mb-3">
                            <label for="max-drawdown" class="form-label">Rút vốn tối đa cho phép (%)</label>
                            <input type="number" class="form-control" id="max-drawdown" min="1" max="50" value="10">
                            <small class="form-text text-muted">
                                Bot sẽ dừng khi rút vốn vượt ngưỡng này
                            </small>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Các biện pháp bảo mật</label>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="auto-restart-enabled" checked>
                                <label class="form-check-label" for="auto-restart-enabled">
                                    Tự động khởi động lại khi bị lỗi
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="log-ip-activity" checked>
                                <label class="form-check-label" for="log-ip-activity">
                                    Ghi nhật ký hoạt động truy cập
                                </label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="card-footer bg-dark border-secondary">
                    <div class="d-grid">
                        <button type="button" class="btn btn-success" id="save-security-button">
                            <i class="fas fa-save me-1"></i> Lưu cài đặt bảo mật
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/settings.js"></script>
<script>
    // Kiểm tra xem người dùng đến từ thiết bị mobile hay không (từ localStorage)
    document.addEventListener('DOMContentLoaded', function() {
        const isMobileDevice = localStorage.getItem('isMobileDevice') === 'true';
        
        // Thêm nút quay lại trang chủ cho mobile nếu cần
        if (isMobileDevice) {
            console.log("Mobile device detected on settings page");
            
            // Tạo nút quay lại nếu chưa tồn tại
            if (!document.getElementById('mobile-back-btn')) {
                const backBtn = document.createElement('a');
                backBtn.id = 'mobile-back-btn';
                backBtn.href = '/';
                backBtn.className = 'btn btn-outline-secondary position-fixed';
                backBtn.style.top = '10px';
                backBtn.style.left = '10px';
                backBtn.style.zIndex = '1030';
                backBtn.innerHTML = '<i class="bi bi-arrow-left"></i> Trang chủ';
                
                // Đảm bảo rằng khi quay về trang chủ, chế độ mobile được duy trì
                backBtn.addEventListener('click', function(e) {
                    // Không cần e.preventDefault() vì chúng ta muốn chuyển hướng
                    localStorage.setItem('isMobileDevice', 'true');
                });
                
                document.body.appendChild(backBtn);
            }
        }
    });
</script>
{% endblock %}