<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trade History - Crypto Trading Bot</title>
    <!-- Bootstrap Dark Theme CSS -->
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="/static/css/style.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">Crypto Trading Bot</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/strategies">Strategies</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/backtest">Backtest</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/trades">Trade History</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/settings">Settings</a>
                    </li>
                </ul>
                <div class="d-flex">
                    <span class="badge bg-success me-2" id="bot-status-badge">Running</span>
                    <button id="toggle-bot" class="btn btn-sm btn-outline-danger">Stop Bot</button>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row mb-4">
            <div class="col">
                <h2>Trade History</h2>
                <p class="text-muted">View and analyze your trading history and performance metrics</p>
            </div>
        </div>

        <div class="row mb-4">
            <!-- Trading Performance Summary -->
            <div class="col-md-4 mb-3">
                <div class="card h-100">
                    <div class="card-header">
                        <h5 class="card-title">Performance Summary</h5>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-6">
                                <div class="text-center">
                                    <h6 class="text-muted mb-1">Win Rate</h6>
                                    <h3 id="win-rate" class="mb-0">68%</h3>
                                    <small class="text-muted">34/50 trades</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-center">
                                    <h6 class="text-muted mb-1">Profit Factor</h6>
                                    <h3 id="profit-factor" class="mb-0">2.1</h3>
                                </div>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-6">
                                <div class="text-center">
                                    <h6 class="text-muted mb-1">Total Profit</h6>
                                    <h3 id="total-profit" class="text-success mb-0">+$3,245</h3>
                                    <small class="text-success">+32.45%</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-center">
                                    <h6 class="text-muted mb-1">Max Drawdown</h6>
                                    <h3 id="max-drawdown" class="text-danger mb-0">12.3%</h3>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-6">
                                <div class="text-center">
                                    <h6 class="text-muted mb-1">Avg Win</h6>
                                    <h4 id="avg-win" class="text-success mb-0">2.8%</h4>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-center">
                                    <h6 class="text-muted mb-1">Avg Loss</h6>
                                    <h4 id="avg-loss" class="text-danger mb-0">-1.2%</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Equity Curve -->
            <div class="col-md-8 mb-3">
                <div class="card h-100">
                    <div class="card-header">
                        <h5 class="card-title">Equity Curve</h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container" style="position: relative; height: 250px;">
                            <canvas id="equity-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Trade History Filters -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title">Filters</h5>
            </div>
            <div class="card-body">
                <form id="filter-form" class="row g-3">
                    <div class="col-md-3">
                        <label for="date-range" class="form-label">Date Range</label>
                        <select class="form-select" id="date-range">
                            <option value="7d">Last 7 days</option>
                            <option value="30d" selected>Last 30 days</option>
                            <option value="90d">Last 90 days</option>
                            <option value="180d">Last 180 days</option>
                            <option value="365d">Last 365 days</option>
                            <option value="all">All time</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="symbol-filter" class="form-label">Symbol</label>
                        <select class="form-select" id="symbol-filter">
                            <option value="all" selected>All</option>
                            <option value="BTCUSDT">BTC/USDT</option>
                            <option value="ETHUSDT">ETH/USDT</option>
                            <option value="BNBUSDT">BNB/USDT</option>
                            <option value="SOLUSDT">SOL/USDT</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="strategy-filter" class="form-label">Strategy</label>
                        <select class="form-select" id="strategy-filter">
                            <option value="all" selected>All</option>
                            <option value="rsi">RSI</option>
                            <option value="macd">MACD</option>
                            <option value="ml">Machine Learning</option>
                            <option value="composite">Composite</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="result-filter" class="form-label">Result</label>
                        <select class="form-select" id="result-filter">
                            <option value="all" selected>All</option>
                            <option value="profit">Profit</option>
                            <option value="loss">Loss</option>
                        </select>
                    </div>
                    <div class="col-12 text-end">
                        <button type="button" class="btn btn-primary" id="apply-filters">Apply Filters</button>
                        <button type="button" class="btn btn-outline-secondary" id="reset-filters">Reset</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Trade History Table -->
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">Trade History</h5>
                <button class="btn btn-sm btn-outline-primary" id="export-trades">Export CSV</button>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Symbol</th>
                                <th>Type</th>
                                <th>Entry Price</th>
                                <th>Exit Price</th>
                                <th>Quantity</th>
                                <th>PnL (USDT)</th>
                                <th>PnL (%)</th>
                                <th>Duration</th>
                                <th>Strategy</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="trades-table">
                            <!-- Example trade data -->
                            <tr class="trade-row profit-row">
                                <td>2025-02-26 14:32</td>
                                <td>BTC/USDT</td>
                                <td class="text-success">LONG</td>
                                <td>$82,456.12</td>
                                <td>$84,210.35</td>
                                <td>0.025</td>
                                <td class="text-success">+$43.85</td>
                                <td class="text-success">+2.13%</td>
                                <td>4h 23m</td>
                                <td>ML Strategy</td>
                                <td>
                                    <button class="btn btn-sm btn-action btn-outline-info view-trade" data-trade-id="1">
                                        View
                                    </button>
                                </td>
                            </tr>
                            <tr class="trade-row loss-row">
                                <td>2025-02-25 10:15</td>
                                <td>ETH/USDT</td>
                                <td class="text-danger">SHORT</td>
                                <td>$2,280.45</td>
                                <td>$2,315.20</td>
                                <td>0.35</td>
                                <td class="text-danger">-$12.16</td>
                                <td class="text-danger">-1.52%</td>
                                <td>2h 10m</td>
                                <td>RSI Strategy</td>
                                <td>
                                    <button class="btn btn-sm btn-action btn-outline-info view-trade" data-trade-id="2">
                                        View
                                    </button>
                                </td>
                            </tr>
                            <tr class="trade-row profit-row">
                                <td>2025-02-24 22:08</td>
                                <td>SOL/USDT</td>
                                <td class="text-success">LONG</td>
                                <td>$124.32</td>
                                <td>$129.58</td>
                                <td>2.5</td>
                                <td class="text-success">+$13.15</td>
                                <td class="text-success">+4.23%</td>
                                <td>8h 45m</td>
                                <td>Composite Strategy</td>
                                <td>
                                    <button class="btn btn-sm btn-action btn-outline-info view-trade" data-trade-id="3">
                                        View
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card-footer">
                <nav aria-label="Trade history pagination">
                    <ul class="pagination justify-content-center mb-0">
                        <li class="page-item disabled">
                            <a class="page-link" href="#" tabindex="-1">Previous</a>
                        </li>
                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                        <li class="page-item">
                            <a class="page-link" href="#">Next</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
        
        <!-- Trade Distribution Analysis -->
        <div class="row">
            <div class="col-md-6 mb-4">
                <div class="card h-100">
                    <div class="card-header">
                        <h5 class="card-title">Trade Distribution by Symbol</h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container" style="position: relative; height: 250px;">
                            <canvas id="symbols-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6 mb-4">
                <div class="card h-100">
                    <div class="card-header">
                        <h5 class="card-title">Win/Loss by Strategy</h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container" style="position: relative; height: 250px;">
                            <canvas id="strategies-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Trade Details Modal -->
    <div class="modal fade" id="tradeDetailsModal" tabindex="-1" aria-labelledby="tradeDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="tradeDetailsModalLabel">Trade Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <h6>Trade Information</h6>
                                <table class="table table-sm">
                                    <tbody>
                                        <tr>
                                            <td><strong>ID:</strong></td>
                                            <td id="trade-id">12345</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Symbol:</strong></td>
                                            <td id="trade-symbol">BTC/USDT</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Direction:</strong></td>
                                            <td id="trade-direction">LONG</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Strategy:</strong></td>
                                            <td id="trade-strategy">ML Strategy</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Entry Date:</strong></td>
                                            <td id="trade-entry-date">2025-02-26 14:32:15</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Exit Date:</strong></td>
                                            <td id="trade-exit-date">2025-02-26 18:55:42</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Duration:</strong></td>
                                            <td id="trade-duration">4h 23m 27s</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <h6>Financial Details</h6>
                                <table class="table table-sm">
                                    <tbody>
                                        <tr>
                                            <td><strong>Entry Price:</strong></td>
                                            <td id="trade-entry-price">$82,456.12</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Exit Price:</strong></td>
                                            <td id="trade-exit-price">$84,210.35</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Quantity:</strong></td>
                                            <td id="trade-quantity">0.025 BTC</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Position Size:</strong></td>
                                            <td id="trade-position-size">$2,061.40</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Profit/Loss:</strong></td>
                                            <td id="trade-pnl" class="text-success">+$43.85 (+2.13%)</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Fees:</strong></td>
                                            <td id="trade-fees">$4.12</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Net Profit:</strong></td>
                                            <td id="trade-net-profit" class="text-success">+$39.73</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <h6>Trade Chart</h6>
                        <div class="chart-container" style="position: relative; height: 300px;">
                            <canvas id="trade-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <h6>Signal Analysis</h6>
                        <div class="p-3 border rounded bg-dark">
                            <table class="table table-sm mb-0">
                                <thead>
                                    <tr>
                                        <th>Indicator</th>
                                        <th>Value</th>
                                        <th>Signal</th>
                                        <th>Confidence</th>
                                    </tr>
                                </thead>
                                <tbody id="signal-analysis-table">
                                    <tr>
                                        <td>RSI</td>
                                        <td>28.5</td>
                                        <td class="text-success">BUY</td>
                                        <td>
                                            <div class="progress" style="height: 5px;">
                                                <div class="progress-bar bg-success" style="width: 85%"></div>
                                            </div>
                                            <small>85%</small>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>MACD</td>
                                        <td>+0.023</td>
                                        <td class="text-success">BUY</td>
                                        <td>
                                            <div class="progress" style="height: 5px;">
                                                <div class="progress-bar bg-success" style="width: 75%"></div>
                                            </div>
                                            <small>75%</small>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>BB</td>
                                        <td>Lower band</td>
                                        <td class="text-success">BUY</td>
                                        <td>
                                            <div class="progress" style="height: 5px;">
                                                <div class="progress-bar bg-success" style="width: 80%"></div>
                                            </div>
                                            <small>80%</small>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>ML Prediction</td>
                                        <td>Uptrend</td>
                                        <td class="text-success">BUY</td>
                                        <td>
                                            <div class="progress" style="height: 5px;">
                                                <div class="progress-bar bg-success" style="width: 82%"></div>
                                            </div>
                                            <small>82%</small>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div>
                        <h6>Trade Notes</h6>
                        <div class="p-3 border rounded bg-dark">
                            <p id="trade-notes" class="mb-0">
                                Entry based on strong oversold RSI signal confirmed by MACD crossover. 
                                Market sentiment was improving with increased volume. Exit triggered by 
                                take profit level after Bitcoin broke through resistance at $84,000.
                            </p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JavaScript Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JavaScript -->
    <script src="/static/js/trades.js"></script>
</body>
</html>